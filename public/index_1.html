<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dicing with Death</title>
</head>
<body>
    <h1><a href="#" target=”_blank” id="video_url"><span id="title">Title</span></a></h1>
    <h2>Video <span id="video_num">0</span></h2>
    <h2><a href="#" target=”_blank” id="wiki_url">Wiki entry</a></span></h2>
</body>
<script src="dwd_data.js"></script>
<script>
    function update_episode(ep) {
        current_ep = Math.min(Math.max(ep,0),episodes.length-1)
        
        ep = episodes[current_ep]
        
        title_el.innerText = ep.title
        num_el.innerText = ep.num
        url_el.href = generateUrl(ep)
        wiki_el.href = generateWikiUrl(ep)
    }
    
    title_el = document.querySelector('#title')
    num_el   = document.querySelector('#video_num')
    url_el   = document.querySelector('#video_url')
    wiki_el  = document.querySelector('#wiki_url')
    
    var current_ep = localStorage.getItem('current_ep');
    if (current_ep !== null) {
        // Do something with the retrieved value
        console.log('Retrieved current episode:', current_ep);
    } else {
        // Handle the case where the key doesn't exist in local storage
        console.log('Key not found in local storage');
        localStorage.setItem('current_ep', 0);
    }
    
    update_episode(current_ep)
    
    document.addEventListener('keydown', function(event) {
        // Check if the key pressed is the left arrow key (keyCode 37 or key "ArrowLeft")
        if (event.key === 'ArrowLeft' || event.keyCode === 37) {
            // Your code to handle the left arrow key press goes here
            // For example, you can call a function or perform some action
            update_episode(current_ep - 1);
        }
        
        // Check if the key pressed is the right arrow key (keyCode 39 or key "ArrowRight")
        if (event.key === 'ArrowRight' || event.keyCode === 39) {
            // Your code to handle the right arrow key press goes here
            // For example, you can call a function or perform some action
            update_episode(current_ep + 1);
        }
    });
    
    let startY = null;
    
    document.addEventListener('touchstart', function(event) {
        // Get the initial Y coordinate of the touch
        startY = event.touches[0].clientY;
    });
    
    document.addEventListener('touchmove', function(event) {
        if (startY === null) {
            return; // No touchstart event recorded
        }
        
        // Calculate the distance the finger has moved vertically
        const currentY = event.touches[0].clientY;
        const deltaY = currentY - startY;
        
        // Define a threshold for vertical movement (e.g., 50 pixels)
        const threshold = 50;
        
        if (Math.abs(deltaY) >= threshold) {
            update_episode(current_ep + Math.sign(deltaY));
            
            // Reset startY to null to track the next touchstart
            startY = currentY;
        }
    });
    
    document.addEventListener('touchend', function() {
        // Reset startY when the touch ends
        startY = null;
    });
    
    window.addEventListener('beforeunload', function (event) {
        // This is where you can execute your code.
        // For example, you can send an analytics event or perform cleanup tasks.
        
        localStorage.setItem('current_ep', current_ep);
        
        // You can also customize the confirmation message shown to the user.
        // event.returnValue = 'Are you sure you want to leave?';
    });
    
</script>
</html>